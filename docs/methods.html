<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Gilberto Camara, Felipe Carlos, and Rolf Simoes">
<title>Land Use and Land Cover Maps for Brazil Emissions Reporting - Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./reclassification.html" rel="next">
<link href="./data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./methods.html">Methods</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Land Use and Land Cover Maps for Brazil Emissions Reporting</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/restore-plus/docs" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./methods.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reclassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reclassification rules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Results</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#land-use-and-land-cover-classes" id="toc-land-use-and-land-cover-classes" class="nav-link active" data-scroll-target="#land-use-and-land-cover-classes">Land Use and Land Cover Classes</a></li>
  <li><a href="#processing-overview" id="toc-processing-overview" class="nav-link" data-scroll-target="#processing-overview">Processing Overview</a></li>
  <li><a href="#stage-1-datacube-generation" id="toc-stage-1-datacube-generation" class="nav-link" data-scroll-target="#stage-1-datacube-generation">Stage 1: Datacube Generation</a></li>
  <li><a href="#stage-2-sample-selection-and-analysis" id="toc-stage-2-sample-selection-and-analysis" class="nav-link" data-scroll-target="#stage-2-sample-selection-and-analysis">Stage 2: Sample Selection and Analysis</a></li>
  <li><a href="#stage-3-model-training" id="toc-stage-3-model-training" class="nav-link" data-scroll-target="#stage-3-model-training">Stage 3: Model Training</a></li>
  <li><a href="#stage-4-datacube-classification" id="toc-stage-4-datacube-classification" class="nav-link" data-scroll-target="#stage-4-datacube-classification">Stage 4: Datacube Classification</a></li>
  <li><a href="#stage-5-reclassification-rules" id="toc-stage-5-reclassification-rules" class="nav-link" data-scroll-target="#stage-5-reclassification-rules">Stage 5: Reclassification rules</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/restore-plus/docs/edit/quarto/methods.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/restore-plus/docs/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Methods</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="land-use-and-land-cover-classes" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="land-use-and-land-cover-classes">Land Use and Land Cover Classes</h2>
<p>The Brazilian National Inventory of Greenhouse Gases Emissions (Inventory) defines a set of land use and land cover classes to be used to estimate the GHG emissions from the AFOLU (Agriculture, Forest and Other Land Uses) sector. However, some of these classes cannot reliably be identified in LANDSAT images, even with advanced machine learning methods. Therefore, the LUC-Brazil project provides a conversion from the Inventory LUCC classes to what can be mapped using LANDSAT, as shown in <a href="#tbl-classes">Table&nbsp;<span>1</span></a>.</p>
<div id="tbl-classes" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Correspondence between LULC classes in the Inventory and LUC=Brazil</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 41%">
<col style="width: 37%">
</colgroup>
<thead><tr class="header">
<th>IPCC Classes</th>
<th>Inventory classes</th>
<th>LUC BRAZIL Amazonia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Forest</td>
<td>Managed Forest</td>
<td>Primary Forest</td>
</tr>
<tr class="even">
<td></td>
<td>Unmanaged Forest</td>
<td>Primary Forest</td>
</tr>
<tr class="odd">
<td></td>
<td>Secondary Forest</td>
<td>Secondary Forests</td>
</tr>
<tr class="even">
<td></td>
<td>Selective Logging</td>
<td>Primary Forest</td>
</tr>
<tr class="odd">
<td></td>
<td>Silviculture</td>
<td>Silviculture</td>
</tr>
<tr class="even">
<td></td>
<td>Other Forested Areas</td>
<td>Primary Forest</td>
</tr>
<tr class="odd">
<td>Cropland</td>
<td>Annual Agriculture</td>
<td>Annual Agriculture</td>
</tr>
<tr class="even">
<td></td>
<td>Semi-Perennial Agriculture</td>
<td>Semi-Perennial Agriculture</td>
</tr>
<tr class="odd">
<td></td>
<td>Perennial Agriculture</td>
<td>Perennial Agriculture</td>
</tr>
<tr class="even">
<td>Grassland</td>
<td>Pasture</td>
<td>Pasture</td>
</tr>
<tr class="odd">
<td></td>
<td>Degraded Pasture</td>
<td>Pasture.</td>
</tr>
<tr class="even">
<td></td>
<td>Managed Grasslands</td>
<td>not mapped</td>
</tr>
<tr class="odd">
<td></td>
<td>Unmanaged Grasslands</td>
<td>Natural Non-Forest Vegetation</td>
</tr>
<tr class="even">
<td></td>
<td>Sucessional Grasslands</td>
<td>not mapped</td>
</tr>
<tr class="odd">
<td></td>
<td>Other Managed Grasslands</td>
<td>not mapped</td>
</tr>
<tr class="even">
<td></td>
<td>Other Managed Grasslands</td>
<td>not mapped</td>
</tr>
<tr class="odd">
<td>Wetland</td>
<td>Water Bodies</td>
<td>Water Bodies</td>
</tr>
<tr class="even">
<td></td>
<td>Other wetlands</td>
<td>Wetlands</td>
</tr>
<tr class="odd">
<td>Settlements</td>
<td>Human Settlements</td>
<td>Urban Areas</td>
</tr>
<tr class="even">
<td>Others</td>
<td>Dunes</td>
<td>Dunes</td>
</tr>
<tr class="odd">
<td></td>
<td>Rocky outcrop</td>
<td>Rocky outcrop</td>
</tr>
<tr class="even">
<td></td>
<td>Mining</td>
<td>Mining</td>
</tr>
<tr class="odd">
<td></td>
<td>Bare Soil</td>
<td>Deforestation</td>
</tr>
<tr class="even">
<td></td>
<td>Unobserved Areas</td>
<td>Unobserved Areas</td>
</tr>
</tbody>
</table>
</div>
</section><section id="processing-overview" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="processing-overview">Processing Overview</h2>
<p>The classification system operates through distinct stages, each handling a specific aspect of the data transformation pipeline from raw satellite imagery to final classified masks.</p>
<ol type="1">
<li>
<strong>Datacube Generation</strong>: Raw Landsat data from multiple sources is regularized into consistent 30m resolution time series for each year.</li>
<li>
<strong>Sample Selection and Analysis </strong>: The project uses a large set of samples containing ground truth information for selected location, described in the data section. These samples are analyzed using: (a) visual interpretation of high-resolution images; (b) quality control methods including self-organized maps. If required, the training set is rebalanced to account for underrepresented classes.</li>
<li>
<strong>Model Training</strong>; Using the cleaned set of samples to derive a machine learning model for classification based on the Random Forest algorithm.</li>
<li>
<strong>Classification</strong>: The Random Forest models classify regularized datacubes into initial land cover categories.</li>
<li>
<strong>Temporal Processing and Year-Specific Refinement</strong>: Multi-year rules refine classifications by analyzing temporal patterns. Individual annual masks undergo sequential reclassification rules.</li>
</ol></section><section id="stage-1-datacube-generation" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="stage-1-datacube-generation">Stage 1: Datacube Generation</h2>
<p>The pipeline begins by ingesting raw Landsat imagery from two distinct sources, each optimized for different temporal periods. This stage produces regularized datacubes with consistent 30m spatial resolution and regular temporal intervals. These sources are described in the “Data” section.</p>
<p>Machine learning and deep learning (ML/DL) classification algorithms require the input data to be consistent. The dimensionality of the data used for training the model has to be the same as that of the data to be classified. There should be no gaps and no missing values. Thus, to use machine learning algorithms for remote sensing data, image collections should be converted to regular data cubes. The LUC-Brasil project uses regular data cubes produced by GLAD (Global Land Analysis &amp; Discovery) from the University of Maryland for the period 2000-2015 and by the Brazil Data Cube for the period 2015-2025. The reason to use the GLAD data before 2015 is the limitations of the Landsat-5 and Landsat-7 satellites which were available in this period. The team at University of Maryland invested in reducing the radiometric and geometric problems of these satellites. To do so, they chose a two-month interval for their time series. By contrast, images in the Brazil Data Cube from 2015 onwards rely primarily on the Landsat-8 satellite, which has a much better geometrical and radiometric quality than the previous Landsat satellites. For this reason, images from 2015 onwards have a one-month temporal interval. This multi-source temporal integration enables robust classification across the 25-year analysis period (2000-2025) despite varying data availability.</p>
<p>The Brazilian Amazon biome was divided into four ecoregions, according to their intrinsic natural variability and different patterns of human occupation (see <a href="#fig-ecoregions">Figure&nbsp;<span>1</span></a>). Ecoregion 1 covers the Amapá and Roraima states, and parts of the Pará and Amazonas states in the North side of the Negro, Solimoes and Amazonas rivers. This regions is largely preserved, but has hot-spots of deforestation in Roraima. It also has a sizeable non-forest area in Roraima. Ecoregion 2 is the area bound by the Madeira and Negro rivers. It is mostly composed of native forest, except for the State of Acre and the recent expansion of deforestation along the Transamazonica road. Ecoregion 3 is the most affected by deforestation since the 1990s, which large areas of clearings used for pasture and agriculture. This is the area of Amazonia that has registered the largest deforestation rates measured by INPE’s PRODES system. Ecoregion 4 includes area of long-term human occupation in the Pará State (Zona Bragantina) where there is significant presence of planted forests and perennial agriculture (e.g., cocoa and oil palm). It is also the region of contact with the Cerrado areas in the State of Maranhão.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ecoregions" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/amazonia_eco_regions.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Ecoregions of the Amazonia biome for classification</figcaption></figure>
</div>
</div>
</div>
</section><section id="stage-2-sample-selection-and-analysis" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="stage-2-sample-selection-and-analysis">Stage 2: Sample Selection and Analysis</h2>
<p>The team analyzed the ground truth samples available described in the “Data” section of this document using visual interpretation, exploratory data analysis, and quality assurance using self-organized maps. The visual analysis step consists of comparing the labelled samples from different sources with image backgrounds which can be either high-resolution images (e.g., Planet) or mid-resolution (e.g., Sentinel-2).</p>
<p>Exploratory data analysis refers to inspecting the samples time series and also finding patterns in the data, as shown in <a href="#fig-methods-explor">Figure&nbsp;<span>2</span></a>. In the left side, one can see the spatial location of the samples for herbaceous pasture provided by EMBRAPA. The graph on the top right shows all of the associated time series for the NDVI band, together with their median (shown in brown) and the first and third quartile ranges (shown in yellow). The graph on the lower right shows a plots that captures the temporal variability of herbaceous pasture samples in the different bands. We use a generalized additive model (GAM) to obtain a single time series based on statistical approximation.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-methods-explor" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/pasture_visual_exploration.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Exploratory data analysis of herbaceous pasture samples</figcaption></figure>
</div>
</div>
</div>
<p>The sample quality assurance part uses self-organizing maps (SOM), a clustering method where high-dimensional data is mapped into a two-dimensional map, The input data for quality assessment is a set of training samples, which are high-dimensional data; for example, a time series with 25 instances of 4 spectral bands has 100 dimensions. When projecting a high-dimensional dataset into a 2D SOM map. Each time series will be mapped to one of the neurons. Since the number of neurons is smaller than the number of classes, each neuron will be associated with many time series. The resulting 2D map will be a set of clusters. The neighbors of each neuron of a SOM map provide information on intraclass and interclass variability, which is used to detect noisy samples. The methodology of using SOM for sample quality assessment is discussed in detail in the reference paper <span class="citation" data-cites="Santos2021a"><a href="#ref-Santos2021a" role="doc-biblioref">[1]</a></span>.</p>
<p>Based on the SOM analysis, we selected two sample collections, one for the 2000-2015 period, and other for the 2015-2025 period, which are summarized below. We first present the training set for 2000-2015.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-sensing/sits/">sits</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>SITS - satellite image time series analysis.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded sits v1.5.5.
        See ?sits for help, citation("sits") for use in publication.
        Documentation avaliable in https://e-sensing.github.io/sitsbook/</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># retrieve the samples for the 2000-2015 period</span></span>
<span><span class="va">samples_amz_2010</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"./etc/samples_amz_2010.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">samples_amz_2010</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   label                      count   prop
   &lt;chr&gt;                      &lt;int&gt;  &lt;dbl&gt;
 1 Annual Agriculture          1160 0.0927
 2 Forest                      1162 0.0929
 3 Herbaceous Pasture          2900 0.232 
 4 Mountainside_Forest          127 0.0102
 5 Riparian_Forest              865 0.0691
 6 Seasonally_Flooded           731 0.0584
 7 Secondary Vegetation        2186 0.175 
 8 Semi-Perennial Agriculture   757 0.0605
 9 Shrubby Pasture              584 0.0467
10 Silviculture                1856 0.148 
11 Wetlands                     184 0.0147</code></pre>
</div>
</div>
<p>Some of the classes used in the training sample set are not included in the final LUC-Brazil classes. These include classes such as “Riparian_Forest” and “Seasonally_Flooded”. These classes are useful to discriminate between different types of natural forests and are later aggregated into the “Forest” class. Other classes produced by LUC-Brazil such as “Perennial Vegetation” are not present in the data set and are added later using reclassification rules. Extensive testing by the team shows that this class is not detectable using Landsat-5 and Landsat-7 images.</p>
<p>For the period 2016-2020, the distribution of the training set is shown below.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># retrieve the samples for the 2000-2015 period</span></span>
<span><span class="va">samples_amz_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"./etc/samples_amz_2010.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">samples_amz_2020</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   label                      count   prop
   &lt;chr&gt;                      &lt;int&gt;  &lt;dbl&gt;
 1 Annual Agriculture          1160 0.0927
 2 Forest                      1162 0.0929
 3 Herbaceous Pasture          2900 0.232 
 4 Mountainside_Forest          127 0.0102
 5 Riparian_Forest              865 0.0691
 6 Seasonally_Flooded           731 0.0584
 7 Secondary Vegetation        2186 0.175 
 8 Semi-Perennial Agriculture   757 0.0605
 9 Shrubby Pasture              584 0.0467
10 Silviculture                1856 0.148 
11 Wetlands                     184 0.0147</code></pre>
</div>
</div>
</section><section id="stage-3-model-training" class="level2"><h2 class="anchored" data-anchor-id="stage-3-model-training">Stage 3: Model Training</h2>
<p>After experimenting with the different algorithms available in `sits, we chose the RandomForest method, which provides a reliable performance in the case of noisy data such as the images from Landsat-5 and Landsat-7 satellite. We performed a 5-fold validation of both models and present thre results below.</p>
<p>The confusion matrix and the metrics for the 2000-2015 model are shown below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kfold-2010-matrix" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/model_2010_conf_matrix.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Confusion matrix for the 2000-2015 Random Forest model</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kfold-2010-metrics" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/model_2010_metrics.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Metrics for the 2000-2015 Random Forest model</figcaption></figure>
</div>
</div>
</div>
<p>The results of the validation show a good degree of discrimination for the classes “Annual_Agriculture”, “Semi-Perennial Agriculture”, and “Herbaceous Pasture”. The natural forest classes (“Forest”, “Mountainside_Forest”, “Riparian_Forest” and “Seasonally_Flooded”) show a reasonable degree of internal confusion, which is not a big problem, since they will later aggreggated into a single class (“Forest”). The confusion between “Secondary_Vegetation” and “Forest” is to be expected; this confusion is solved using the PRODES maps.</p>
<p>Overall, the main problem is the distinction between the “Shrubby Pasture”, “Secondary Vegetation” and “Silviculture” classes. While the TerraClass maps provide a good basis for improving the classification of “Semi=Perennial Agriculture” and “Silviculture” classes, the main problem remains in the distinction between “Shrubby Pasture” and “Secondary Vegetation”. Indeed, these classes are hard to separate even in higher-resolution images.</p>
<p>The confusion matrix and the metrics for the 2016-2025 model are shown below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kfold-2020-matrix" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/model_2020_conf_matrix.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Confusion matrix for the 2016-2025 Random Forest model</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-kfold-2020-metrics" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="./images/model_2020_metrics.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Metrics for the 2016-2025 Random Forest model</figcaption></figure>
</div>
</div>
</div>
<p>The results show that the 2016-2025 model discriminates the classes better than the 2000-2015 one. This outcome is expected due to the better quality of the Landsat-8 images. Compared to the 2000-2015 model, the “Silviculture” class is better defined, and the distinction between “Secondary Vegetation” and “Herbaceous Pasture” improves. The same remarks made earlier about the natural classes apply also in this case.</p>
</section><section id="stage-4-datacube-classification" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="stage-4-datacube-classification">Stage 4: Datacube Classification</h2>
<p>The datacube classification is done on an yearly basis. For each year, each spatial location (pixel) of the data cubes is associated to a time series. Each time series is then classified by the machine learning model. The result is a classified map for each year. The classification process is described in the detail in the <a href="https://e-sensing.github.io/sitsbook/">on-line book</a> about the <code>sits</code> package.</p>
</section><section id="stage-5-reclassification-rules" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="stage-5-reclassification-rules">Stage 5: Reclassification rules</h2>
<p>After the annual classification maps have been produced, the LUC-Brazil team applies a series of reclassification rules, which are described in detail in the next section.</p>
</section><section id="references" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-Santos2021a" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">L. A. Santos, K. R. Ferreira, G. Camara, M. C. A. Picoli, and R. E. Simoes, <span>“Quality control and class noise reduction of satellite image time series,”</span> <em>ISPRS Journal of Photogrammetry and Remote Sensing</em>, vol. 177, pp. 75–88, 2021, doi: <a href="https://doi.org/10.1016/j.isprsjprs.2021.04.014">10.1016/j.isprsjprs.2021.04.014</a>.</div>
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data Sets</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./reclassification.html" class="pagination-link">
        <span class="nav-page-text">Reclassification rules</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Edited by Gilberto Camara, Felipe Carlos, and Rolf Simoes.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>